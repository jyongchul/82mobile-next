---
wave: 1
depends_on: []
files_modified:
  - /wp-content/plugins/redis-cache/ (if Gabia supports)
  - /wp-content/object-cache.php (if Redis available)
  - /mnt/c/82Mobile/82mobile-next/scripts/install_redis_cache.py
  - /mnt/c/82Mobile/82mobile-next/.planning/phases/02-infrastructure-caching/REDIS-STATUS.md
autonomous: true
---

# Plan 02-02: Redis Object Cache Installation & Testing

## Objective

Test Gabia hosting for Redis support and install Redis Object Cache plugin if available. If Redis is unsupported, document limitation and proceed without it (Redis is performance optimization, not a blocker).

## Context

Redis Object Cache improves WordPress performance by caching database queries, but Gabia shared hosting Redis support is unknown. This plan tests availability first, installs if supported, and explicitly documents if unavailable.

**Critical constraint**: Must NOT assume Redis is available. Test-first approach with graceful fallback.

## Tasks

<task id="1" title="Test Gabia Redis availability">

**Goal**: Determine if Gabia hosting supports Redis connections before attempting plugin installation.

**Steps**:
1. Create test script `/mnt/c/82Mobile/82mobile-next/scripts/test_redis_connection.php`:
   ```php
   <?php
   // Test Redis connectivity on Gabia hosting

   $redis_available = false;
   $error_message = '';

   // Test 1: Check if Redis extension loaded
   if (extension_loaded('redis')) {
       echo "✓ PHP Redis extension loaded\n";

       // Test 2: Try connection to common Redis hosts
       $hosts = ['localhost', '127.0.0.1', 'redis'];
       foreach ($hosts as $host) {
           try {
               $redis = new Redis();
               if ($redis->connect($host, 6379, 1)) {
                   echo "✓ Redis connection successful: $host:6379\n";
                   $redis_available = true;
                   break;
               }
           } catch (Exception $e) {
               $error_message .= "✗ $host:6379 - " . $e->getMessage() . "\n";
           }
       }
   } else {
       $error_message = "✗ PHP Redis extension not loaded\n";
   }

   // Output JSON result
   echo json_encode([
       'available' => $redis_available,
       'error' => $error_message,
       'timestamp' => date('Y-m-d H:i:s')
   ]);
   ?>
   ```

2. Upload test script via FTP to `/test_redis_connection.php` (WordPress root)
3. Execute via HTTP: `curl http://82mobile.com/test_redis_connection.php`
4. Parse JSON response:
   - `available: true` → Proceed to Task 2
   - `available: false` → Skip to Task 4 (document unavailability)
5. Delete test script after execution

**Verification**:
- [ ] Test script created and uploaded
- [ ] Script executed successfully
- [ ] Redis availability determined (true/false)
- [ ] Test script removed from production

**Files created**: `scripts/test_redis_connection.php` (temporary, deleted after test)

</task>

<task id="2" title="Install Redis Object Cache plugin (if Redis available)">

**Goal**: Download and install Redis Object Cache plugin via Playwright automation.

**Conditional**: Only execute if Task 1 determined Redis is available.

**Steps**:
1. Download plugin:
   ```bash
   curl -o redis-cache.zip https://downloads.wordpress.org/plugin/redis-cache.latest-stable.zip
   unzip redis-cache.zip -d /tmp/
   ```

2. Upload via FTP to `/wp-content/plugins/redis-cache/`

3. Activate via Playwright:
   ```python
   from playwright.sync_api import sync_playwright

   with sync_playwright() as p:
       browser = p.chromium.launch(headless=False)
       page = browser.new_page()

       # Login to wp-admin
       page.goto('http://82mobile.com/wp-admin')
       page.fill('#user_login', 'whadmin')
       page.fill('#user_pass', 'WhMkt2026!@AdamKorSim')
       page.click('#wp-submit')

       # Navigate to plugins
       page.goto('http://82mobile.com/wp-admin/plugins.php')

       # Find Redis Cache plugin row
       plugin_row = page.locator('tr[data-slug="redis-cache"]')

       # Click activate link
       activate_link = plugin_row.locator('a:has-text("Activate")')
       if activate_link.is_visible():
           activate_link.click()
           page.wait_for_selector('.updated')
           print("✓ Redis Object Cache activated")
       else:
           print("Plugin already active or not found")
   ```

4. Verify plugin active:
   - Check for "Redis Object Cache" in wp-admin → Plugins
   - Check for `/wp-content/object-cache.php` drop-in file created

**Verification**:
- [ ] Plugin downloaded successfully
- [ ] Files uploaded via FTP
- [ ] Plugin activated in wp-admin
- [ ] object-cache.php drop-in exists

**Files created**: `/wp-content/plugins/redis-cache/`, `/wp-content/object-cache.php`

</task>

<task id="3" title="Configure Redis and verify API freshness (if Redis available)">

**Goal**: Configure Redis Object Cache and verify `/wp-json/*` endpoints are NOT cached by Redis.

**Conditional**: Only execute if Tasks 1-2 succeeded.

**Steps**:
1. Navigate to wp-admin → Settings → Redis
2. Configure settings:
   - **Redis Host**: localhost (or 127.0.0.1 based on Task 1 result)
   - **Redis Port**: 6379
   - **Redis Database**: 0
   - **Max TTL**: 86400 (24 hours)
   - **Exclude Groups**: Add `rest-api`, `wc_session_id` (prevents API caching)

3. Enable Redis Object Cache (click "Enable Object Cache" button)

4. Run API freshness test (same as Plan 02-01 Task 2 Method 2):
   ```python
   # Query product via API
   response1 = requests.get('http://82mobile.com/wp-json/wc/v3/products')
   product = response1.json()[0]
   api_modified_1 = product['date_modified']

   # Update product
   requests.put(f'http://82mobile.com/wp-json/wc/v3/products/{product["id"]}',
                json={'description': f'Redis test {time.time()}'})

   # Query again
   response2 = requests.get('http://82mobile.com/wp-json/wc/v3/products')
   product_2 = response2.json()[0]
   api_modified_2 = product_2['date_modified']

   # Timestamps should differ (not cached)
   assert api_modified_1 != api_modified_2, "API cached by Redis!"
   ```

5. Check Redis cache hit rate in wp-admin → Settings → Redis:
   - Hit rate should be > 0% (cache working)
   - WooCommerce queries cached (performance improved)
   - API endpoints NOT cached (freshness preserved)

**Verification**:
- [ ] Redis configured with correct settings
- [ ] Object cache enabled
- [ ] API freshness test passes (timestamps differ)
- [ ] Redis cache hit rate > 0%

**Files modified**: WordPress options table (Redis settings stored in database)

</task>

<task id="4" title="Document Redis status">

**Goal**: Create comprehensive report on Redis availability and configuration status.

**Steps**:
1. Create `.planning/phases/02-infrastructure-caching/REDIS-STATUS.md`
2. Document based on Task 1 result:

   **If Redis AVAILABLE**:
   ```markdown
   # Redis Object Cache Status

   **Status**: ✅ AVAILABLE
   **Tested**: 2026-01-27
   **Host**: [localhost/127.0.0.1]
   **Port**: 6379

   ## Installation
   - Plugin: Redis Object Cache (version X.X.X)
   - Drop-in: /wp-content/object-cache.php ✓
   - Activation: Success

   ## Configuration
   - Redis Host: localhost
   - Redis Database: 0
   - Max TTL: 86400s (24h)
   - Excluded Groups: rest-api, wc_session_id

   ## Verification
   - Cache hit rate: [X%]
   - API freshness test: PASS
   - WooCommerce queries cached: YES
   - API endpoints cached: NO

   ## Next Steps
   - Redis monitoring: Check hit rate daily
   - Performance baseline: Compare page load times
   ```

   **If Redis UNAVAILABLE**:
   ```markdown
   # Redis Object Cache Status

   **Status**: ❌ UNAVAILABLE
   **Tested**: 2026-01-27
   **Error**: [PHP Redis extension not loaded / Connection failed]

   ## Impact Analysis
   - **Performance**: WordPress database queries not cached (slower wp-admin, slower product queries)
   - **Headless Architecture**: NO IMPACT (API caching handled by .htaccess)
   - **API Freshness**: Not affected (relies on .htaccess cache bypass, not Redis)
   - **Phase 2 Success**: Not blocked (Redis is optimization, not requirement)

   ## Alternatives Considered
   - **Gabia support request**: Contact Gabia to enable Redis (may not be possible on shared hosting)
   - **Memcached**: Alternative object cache (also unlikely on shared hosting)
   - **APCu**: PHP-level cache (may be available, but less effective than Redis)

   ## Recommendation
   - **Proceed without Redis**: Headless architecture works without it
   - **Phase 3+ continues**: No changes to plan
   - **Future optimization**: If site performance degrades, consider upgrading hosting to VPS with Redis

   ## Verification
   - Phase 1 .htaccess cache bypass: Working (verified in Plan 02-01)
   - API endpoint freshness: Not affected by missing Redis
   ```

3. Update REQUIREMENTS.md:
   - If available: Mark BACKEND-07 as "Complete (Redis active)"
   - If unavailable: Mark BACKEND-07 as "Complete (Redis unavailable, proceeded without)"

**Verification**:
- [ ] REDIS-STATUS.md created
- [ ] Status documented (available or unavailable)
- [ ] Impact analysis included
- [ ] Next steps documented

**Files created**: `.planning/phases/02-infrastructure-caching/REDIS-STATUS.md`

</task>

## Must-Haves (Goal-Backward Verification)

When this plan completes, these must be TRUE:

1. **Redis availability tested**: Gabia hosting checked for Redis support with objective test results

2. **Conditional installation**: If Redis available → plugin installed and activated. If unavailable → explicitly documented.

3. **API freshness verified**: If Redis installed → API endpoints confirmed NOT cached by Redis (freshness preserved)

4. **Status documented**: REDIS-STATUS.md exists with complete report on availability, configuration, or unavailability impact

5. **Phase continuity preserved**: Whether Redis available or not, Phase 2 continues (Redis is optimization, not blocker)

**Success means**: We know definitively whether Gabia supports Redis, and have either (a) Redis configured for WooCommerce performance, or (b) explicit documentation that we're proceeding without it.

## Dependencies

**Requires**:
- FTP access to Gabia hosting
- WordPress admin credentials
- Playwright browser automation

**Enables**:
- Performance optimization if Redis available
- Clear documentation for future hosting decisions
- Phase 3 planning (knows whether Redis is in stack)

## Notes

- **Expected outcome**: Redis likely unavailable on Gabia shared hosting
- **Not a blocker**: Headless architecture works without Redis
- **Cache bypass**: Handled by .htaccess (Plan 02-01), not Redis
- **Performance impact**: wp-admin slower without Redis, but API performance unaffected

## Estimated Duration

45 minutes (including Redis availability test and conditional installation)
