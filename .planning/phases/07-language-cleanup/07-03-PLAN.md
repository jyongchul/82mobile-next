---
wave: 3
depends_on: ['07-01', '07-02']
files_modified: []
autonomous: false
---

# Plan 07-03: Verify Bundle Reduction and Complete Cleanup

<objective>
Verify that removing zh/ja languages achieved the expected 30-40KB bundle reduction and perform final cleanup of any remaining zh/ja references in the codebase.
</objective>

<context>
**Current State:**
- zh.json and ja.json deleted (Plan 07-01)
- i18n.ts updated to ['ko', 'en'] (Plan 07-01)
- Language switcher shows only ko/en (Plan 07-02)

**Why This Matters:**
- Bundle size reduction is a key success criterion for Phase 7
- Remaining zh/ja references could cause runtime errors
- Thorough cleanup ensures maintainability

**Expected Outcome:**
- Bundle reduced by 30-40KB per page
- No zh/ja references in codebase (except comments/docs)
- All routes and components work correctly with ko/en only

**This is a Verification Checkpoint:**
- Autonomous: false (requires human verification of bundle sizes)
- User will confirm bundle reduction from build output
</context>

<tasks>

<task id="1">
<description>
Run production build and capture bundle size metrics
</description>
<details>
Run a clean production build and compare bundle sizes to Phase 6 baseline:

```bash
# Clean previous build
rm -rf .next

# Run production build
npm run build
```

**Capture build output showing:**
- Route sizes for /ko and /en
- First Load JS for each route
- Comparison to previous build (if available)

Example output to look for:
```
Route (app)                              Size     First Load JS
┌ ○ /[locale]                           142 B          85.4 kB  ← After cleanup
├ ○ /[locale]/shop                      185 B          118 kB   ← After cleanup
└ ...

Previously (Phase 6):
┌ ○ /[locale]                           142 B          120 kB   ← Before cleanup
├ ○ /[locale]/shop                      185 B          152 KB   ← Before cleanup
```

Expected reduction: ~30-40KB per route
</details>
</task>

<task id="2">
<description>
Search codebase for remaining zh/ja references
</description>
<details>
Perform comprehensive search for any remaining Chinese or Japanese language references:

```bash
# Search for zh/ja locale references
grep -r "zh\|ja" . --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" \
  --exclude-dir=node_modules --exclude-dir=.next --exclude-dir=.git

# Search for Chinese/Japanese characters (might be in comments/strings)
grep -r "中文\|日本語" . --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" \
  --exclude-dir=node_modules --exclude-dir=.next --exclude-dir=.git

# Check for locale-specific imports
grep -r "messages/zh\|messages/ja" . --include="*.ts" --include="*.tsx" \
  --exclude-dir=node_modules --exclude-dir=.next

# Check for hardcoded locale arrays
grep -r "\['ko', 'en', 'zh', 'ja'\]" . --include="*.ts" --include="*.tsx" \
  --exclude-dir=node_modules --exclude-dir=.next
```

**Acceptable matches:**
- Comments explaining the removal (e.g., "// Removed zh/ja support")
- This PLAN.md file
- Git commit messages
- Documentation files

**Unacceptable matches:**
- Runtime code still referencing zh/ja
- Config files with zh/ja in locale arrays
- Components checking for zh/ja locales
</details>
</task>

<task id="3">
<description>
Test all critical user flows in ko and en
</description>
<details>
Manual testing checklist to ensure both locales work correctly:

**Korean (ko) Testing:**
1. Visit http://localhost:3000/ko
2. Navigate through: Hero → Products → Cart → Checkout
3. Switch to English from language switcher
4. Verify no console errors

**English (en) Testing:**
1. Visit http://localhost:3000/en
2. Navigate through: Hero → Products → Cart → Checkout
3. Switch to Korean from language switcher
4. Verify no console errors

**404 Testing (should fail gracefully):**
1. Try http://localhost:3000/zh - should 404
2. Try http://localhost:3000/ja - should 404
3. Verify error page shows correctly

**Translation Coverage:**
- No missing translation keys (check console for warnings)
- All UI text displays correctly in both languages
- Currency/date formatting works for both locales
</details>
</task>

<task id="4">
<description>
Update any documentation referencing 4 languages
</description>
<details>
Search for and update documentation that mentions zh/ja support:

```bash
# Check README and docs for outdated language references
grep -r "Chinese\|Japanese\|zh\|ja\|中文\|日本語" *.md docs/ --exclude-dir=.planning

# Common files to check:
# - README.md
# - docs/i18n.md (if exists)
# - CONTRIBUTING.md (if exists)
# - package.json description
```

Update any mentions of "4 languages" or "ko/en/zh/ja" to reflect "2 languages" or "ko/en only".

Example update:
**Before:** "82Mobile supports 4 languages: Korean, English, Chinese, and Japanese"
**After:** "82Mobile supports 2 languages: Korean and English"
</details>
</task>

<task id="5">
<description>
CHECKPOINT: Review bundle reduction with user
</description>
<details>
**Present build output to user for verification:**

Show before/after comparison:

```
Phase 6 (Before Cleanup):
- First Load JS: ~120-125KB per route
- Total bundle with all locales: ~480KB

Phase 7 (After Cleanup):
- First Load JS: ~85-90KB per route ← Target
- Total bundle with ko/en only: ~340KB
- Reduction: ~30-40KB per route ✓
```

**Ask user:**
1. Does the bundle size reduction meet expectations (30-40KB)?
2. Are there any remaining concerns about language support?
3. Ready to commit final changes and mark Phase 7 complete?

**If bundle reduction is less than expected:**
- Investigate what's still loading (check build output)
- May need to check for lazy-loaded language files
- Consider running lighthouse audit for detailed analysis

**If user approves:** Proceed to Task 6
**If user has concerns:** Address issues before committing
</details>
</task>

<task id="6">
<description>
Commit verification results and complete Phase 7
</description>
<details>
Create final commit documenting Phase 7 completion:

```bash
git add .
git commit -m "$(cat <<'EOF'
docs(i18n): verify Phase 7 language cleanup complete

Bundle reduction verified:
- First Load JS reduced by ~35KB per route
- Total bundle: ~340KB (down from ~480KB)
- All routes tested in ko/en ✓
- No remaining zh/ja references ✓

Phase 7 success criteria met:
1. ✓ Files Removed: zh.json, ja.json deleted
2. ✓ Switcher Updated: Shows only ko/en options
3. ✓ Config Updated: locales = ['ko', 'en']
4. ✓ Bundle Reduced: 30-40KB reduction achieved

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
EOF
)"
```
</details>
</task>

</tasks>

<verification>

**Bundle Size Verification (Critical):**

Compare build output before and after cleanup:

```bash
# Check current bundle sizes
npm run build | grep "First Load JS"

# Expected output:
Route (app)                              Size     First Load JS
┌ ○ /[locale]                           142 B    ~85 kB     ← Target
├ ○ /[locale]/shop                      185 B    ~120 kB    ← Target
└ ...
```

**Success criteria:**
- Each route's First Load JS reduced by 30-40KB
- No increase in other bundle sizes
- Build completes without errors

**Code Search Verification:**

```bash
# Should return 0 results (except docs/plans):
grep -r "zh\|ja" components/ lib/ app/ --include="*.ts" --include="*.tsx" | \
  grep -v "\.planning" | grep -v "comment" | wc -l
```

**Runtime Verification:**

1. Both ko and en routes work perfectly
2. No console errors when switching languages
3. No missing translation warnings
4. zh/ja routes properly 404

</verification>

<must_haves>

These criteria must be met for Plan 07-03 to be considered complete:

1. **Bundle Reduced**: First Load JS reduced by 30-40KB per route (verified in build output)
2. **No zh/ja References**: Codebase search returns no runtime references to zh/ja (comments/docs OK)
3. **All Routes Tested**: Both /ko and /en routes fully functional (Hero → Products → Cart → Checkout)
4. **404s Work**: /zh and /ja routes properly return 404 errors
5. **User Approval**: User confirms bundle reduction meets expectations

</must_haves>

---

**Estimated Time:** 30-45 minutes
**Complexity:** Medium (requires build analysis and thorough testing)
**Risk:** Low (verification only, no code changes)
**Checkpoint:** Requires user confirmation of bundle reduction before completion
