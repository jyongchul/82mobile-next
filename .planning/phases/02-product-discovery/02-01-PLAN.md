---
phase: 02-product-discovery
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/home/ProductsSection.tsx
  - components/home/SinglePageHome.tsx
  - hooks/useProducts.ts
autonomous: true

must_haves:
  truths:
    - "Products section displays real WooCommerce products, not mock data"
    - "Products load asynchronously with loading state"
    - "Empty state shown when no products available"
    - "Error state shown when API fails"
  artifacts:
    - path: "components/home/ProductsSection.tsx"
      provides: "Real product grid with WooCommerce data"
      exports: ["ProductsSection"]
    - path: "hooks/useProducts.ts"
      provides: "React Query hook for fetching products"
      exports: ["useProducts"]
  key_links:
    - from: "components/home/ProductsSection.tsx"
      to: "hooks/useProducts.ts"
      via: "useProducts() hook call"
      pattern: "useProducts\\("
    - from: "hooks/useProducts.ts"
      to: "/api/products"
      via: "fetch in useQuery"
      pattern: "fetch.*api/products"
---

<objective>
Create ProductsSection component that fetches real products from WooCommerce API and displays them in a grid on the single-page homepage.

Purpose: Replace mock data in ProductPreview with real WooCommerce products to enable actual shopping functionality.
Output: ProductsSection component integrated into SinglePageHome, fetching live product data.
</objective>

<execution_context>
@/home/charles_lee/.claude/get-shit-done/workflows/execute-plan.md
@/home/charles_lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@components/home/SinglePageHome.tsx
@components/home/ProductPreview.tsx
@components/shop/ProductCard.tsx
@app/api/products/route.ts
@stores/cart.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useProducts React Query hook</name>
  <files>hooks/useProducts.ts</files>
  <action>
Create a React Query hook that fetches products from /api/products:

```typescript
import { useQuery } from '@tanstack/react-query';

interface Product {
  id: number;
  slug: string;
  name: string;
  price: string;
  regularPrice?: string;
  image: string;
  category: string;
  description: string;
  duration?: string;
  dataAmount?: string;
}

export function useProducts(options?: {
  category?: string;
  limit?: number;
}) {
  return useQuery({
    queryKey: ['products', options?.category, options?.limit],
    queryFn: async () => {
      const params = new URLSearchParams();
      if (options?.category) params.set('category', options.category);
      if (options?.limit) params.set('limit', String(options.limit));

      const res = await fetch(`/api/products?${params}`);
      if (!res.ok) throw new Error('Failed to fetch products');

      const data = await res.json();
      return data.products as Product[];
    },
    staleTime: 5 * 60 * 1000, // 5 minutes
    gcTime: 30 * 60 * 1000, // 30 minutes cache
  });
}
```

Key requirements:
- Export Product type for use in components
- Support category filter and limit params
- Set appropriate staleTime for performance
- Return typed data from React Query
  </action>
  <verify>TypeScript compiles without errors: `cd /mnt/c/82Mobile/82mobile-next && npx tsc --noEmit`</verify>
  <done>useProducts hook exists and exports Product type</done>
</task>

<task type="auto">
  <name>Task 2: Create ProductsSection component with API integration</name>
  <files>components/home/ProductsSection.tsx, components/home/SinglePageHome.tsx</files>
  <action>
Create ProductsSection component that uses useProducts hook:

```typescript
'use client';

import { useProducts } from '@/hooks/useProducts';
import ProductCard from '@/components/shop/ProductCard';

export default function ProductsSection() {
  const { data: products, isLoading, error } = useProducts({ limit: 6 });

  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {[...Array(6)].map((_, i) => (
          <div key={i} className="animate-pulse">
            <div className="bg-gray-200 rounded-2xl h-64 mb-4" />
            <div className="bg-gray-200 h-6 rounded w-3/4 mb-2" />
            <div className="bg-gray-200 h-8 rounded w-1/2" />
          </div>
        ))}
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-center py-12">
        <p className="text-red-600 mb-4">Failed to load products</p>
        <button
          onClick={() => window.location.reload()}
          className="px-4 py-2 bg-dancheong-red text-white rounded-lg"
        >
          Retry
        </button>
      </div>
    );
  }

  if (!products?.length) {
    return (
      <div className="text-center py-12">
        <p className="text-gray-500">No products available</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {products.map((product) => (
        <ProductCard
          key={product.id}
          id={product.id}
          slug={product.slug}
          name={product.name}
          price={product.price}
          regularPrice={product.regularPrice}
          image={product.image}
          duration={product.duration}
          dataAmount={product.dataAmount}
        />
      ))}
    </div>
  );
}
```

Then update SinglePageHome.tsx:
1. Import ProductsSection: `import ProductsSection from './ProductsSection';`
2. Replace `<ProductPreview />` with `<ProductsSection />` in the products section
3. Keep the section wrapper with id="products" and styling
  </action>
  <verify>
1. Run dev server: `cd /mnt/c/82Mobile/82mobile-next && npm run dev`
2. Open http://localhost:3000 and scroll to Products section
3. Verify products load from API (not mock data)
4. Verify loading skeleton appears briefly
  </verify>
  <done>Products section shows real WooCommerce products with loading state</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Products section displays real products from WooCommerce
3. Loading skeleton shows during fetch
4. Error state shows when API fails (test by stopping WooCommerce)
5. Empty state shows when no products
</verification>

<success_criteria>
- ProductsSection fetches and displays WooCommerce products
- Loading, error, and empty states all implemented
- No mock data in production code
- React Query caching working (check Network tab)
</success_criteria>

<output>
After completion, create `.planning/phases/02-product-discovery/02-01-SUMMARY.md`
</output>
