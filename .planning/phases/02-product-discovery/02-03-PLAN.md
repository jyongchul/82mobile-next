---
phase: 02-product-discovery
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/home/ProductFilter.tsx
  - components/home/ProductsSection.tsx
autonomous: true

must_haves:
  truths:
    - "User can filter products by type (eSIM/Physical/All)"
    - "User can filter products by duration (3-day, 7-day, 30-day, All)"
    - "Filters update product grid in real-time without page reload"
    - "Active filter state is visually indicated"
  artifacts:
    - path: "components/home/ProductFilter.tsx"
      provides: "Product filter UI with type and duration options"
      exports: ["ProductFilter"]
  key_links:
    - from: "components/home/ProductsSection.tsx"
      to: "components/home/ProductFilter.tsx"
      via: "renders ProductFilter with onFilterChange callback"
      pattern: "<ProductFilter"
    - from: "components/home/ProductsSection.tsx"
      to: "hooks/useProducts.ts"
      via: "passes filter state to useProducts"
      pattern: "useProducts\\(.*filter"
---

<objective>
Implement product filtering by type (eSIM/Physical) and duration to help users quickly find relevant plans.

Purpose: With 6+ products displayed, users need filtering to narrow options without scrolling through all products.
Output: ProductFilter component integrated with ProductsSection, filtering products client-side.
</objective>

<execution_context>
@/home/charles_lee/.claude/get-shit-done/workflows/execute-plan.md
@/home/charles_lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@components/home/ProductsSection.tsx (created in Plan 01)
@hooks/useProducts.ts (created in Plan 01)
@components/shop/ProductFilter.tsx (existing, for reference)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProductFilter component for homepage</name>
  <files>components/home/ProductFilter.tsx</files>
  <action>
Create a simplified filter component for the single-page homepage:

```typescript
'use client';

import { useState } from 'react';
import { motion } from 'framer-motion';

export interface FilterState {
  type: 'all' | 'esim' | 'physical';
  duration: 'all' | '3-day' | '7-day' | '10-day' | '30-day';
}

interface ProductFilterProps {
  onFilterChange: (filters: FilterState) => void;
  initialFilters?: FilterState;
}

const typeOptions = [
  { value: 'all', label: 'All Types', icon: 'ðŸ“±' },
  { value: 'esim', label: 'eSIM', icon: 'ðŸ“¶' },
  { value: 'physical', label: 'Physical SIM', icon: 'ðŸ’³' },
] as const;

const durationOptions = [
  { value: 'all', label: 'All Durations' },
  { value: '3-day', label: '3 Days' },
  { value: '7-day', label: '7 Days' },
  { value: '10-day', label: '10 Days' },
  { value: '30-day', label: '30 Days' },
] as const;

export default function ProductFilter({
  onFilterChange,
  initialFilters = { type: 'all', duration: 'all' }
}: ProductFilterProps) {
  const [filters, setFilters] = useState<FilterState>(initialFilters);

  const updateFilter = <K extends keyof FilterState>(
    key: K,
    value: FilterState[K]
  ) => {
    const newFilters = { ...filters, [key]: value };
    setFilters(newFilters);
    onFilterChange(newFilters);
  };

  return (
    <div className="flex flex-col sm:flex-row gap-4 items-center justify-center mb-8">
      {/* Type Filter */}
      <div className="flex gap-2 p-1 bg-gray-100 rounded-xl">
        {typeOptions.map((option) => (
          <button
            key={option.value}
            onClick={() => updateFilter('type', option.value)}
            className={`relative px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
              filters.type === option.value
                ? 'text-white'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            {filters.type === option.value && (
              <motion.div
                layoutId="type-indicator"
                className="absolute inset-0 bg-dancheong-red rounded-lg"
                transition={{ type: 'spring', bounce: 0.2, duration: 0.6 }}
              />
            )}
            <span className="relative z-10 flex items-center gap-1">
              <span>{option.icon}</span>
              <span className="hidden sm:inline">{option.label}</span>
            </span>
          </button>
        ))}
      </div>

      {/* Duration Filter */}
      <div className="flex gap-2 p-1 bg-gray-100 rounded-xl">
        {durationOptions.map((option) => (
          <button
            key={option.value}
            onClick={() => updateFilter('duration', option.value)}
            className={`relative px-3 py-2 rounded-lg text-sm font-medium transition-colors ${
              filters.duration === option.value
                ? 'text-white'
                : 'text-gray-600 hover:text-gray-900'
            }`}
          >
            {filters.duration === option.value && (
              <motion.div
                layoutId="duration-indicator"
                className="absolute inset-0 bg-hanbok-blue rounded-lg"
                transition={{ type: 'spring', bounce: 0.2, duration: 0.6 }}
              />
            )}
            <span className="relative z-10">{option.label}</span>
          </button>
        ))}
      </div>
    </div>
  );
}
```

Key features:
- Pill-style toggle buttons with animated indicator
- Type filter: All, eSIM, Physical SIM
- Duration filter: All, 3-day, 7-day, 10-day, 30-day
- Mobile responsive (icons only on small screens for type)
- Framer Motion for smooth indicator animation
  </action>
  <verify>TypeScript compiles: `cd /mnt/c/82Mobile/82mobile-next && npx tsc --noEmit`</verify>
  <done>ProductFilter component created with type and duration filters</done>
</task>

<task type="auto">
  <name>Task 2: Integrate filter with ProductsSection</name>
  <files>components/home/ProductsSection.tsx</files>
  <action>
Update ProductsSection to include ProductFilter and filter products client-side:

```typescript
'use client';

import { useState, useMemo } from 'react';
import { useProducts } from '@/hooks/useProducts';
import ProductCard from '@/components/shop/ProductCard';
import ProductFilter, { FilterState } from './ProductFilter';

export default function ProductsSection() {
  const { data: products, isLoading, error } = useProducts();
  const [filters, setFilters] = useState<FilterState>({ type: 'all', duration: 'all' });

  // Client-side filtering
  const filteredProducts = useMemo(() => {
    if (!products) return [];

    return products.filter((product) => {
      // Type filter
      if (filters.type !== 'all') {
        const productName = product.name.toLowerCase();
        const isESIM = productName.includes('esim') || productName.includes('e-sim');
        if (filters.type === 'esim' && !isESIM) return false;
        if (filters.type === 'physical' && isESIM) return false;
      }

      // Duration filter
      if (filters.duration !== 'all') {
        const durationText = product.duration?.toLowerCase() || product.name.toLowerCase();
        const durationMap: Record<string, string[]> = {
          '3-day': ['3 day', '3day', '3-day'],
          '7-day': ['7 day', '7day', '7-day', 'week'],
          '10-day': ['10 day', '10day', '10-day'],
          '30-day': ['30 day', '30day', '30-day', 'month', 'unlimited'],
        };
        const matches = durationMap[filters.duration] || [];
        if (!matches.some(m => durationText.includes(m))) return false;
      }

      return true;
    });
  }, [products, filters]);

  const handleFilterChange = (newFilters: FilterState) => {
    setFilters(newFilters);
  };

  if (isLoading) {
    return (
      <>
        <ProductFilter onFilterChange={handleFilterChange} />
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {[...Array(6)].map((_, i) => (
            <div key={i} className="animate-pulse">
              <div className="bg-gray-200 rounded-2xl h-64 mb-4" />
              <div className="bg-gray-200 h-6 rounded w-3/4 mb-2" />
              <div className="bg-gray-200 h-8 rounded w-1/2" />
            </div>
          ))}
        </div>
      </>
    );
  }

  if (error) {
    return (
      <div className="text-center py-12">
        <p className="text-red-600 mb-4">Failed to load products</p>
        <button
          onClick={() => window.location.reload()}
          className="px-4 py-2 bg-dancheong-red text-white rounded-lg"
        >
          Retry
        </button>
      </div>
    );
  }

  return (
    <>
      <ProductFilter onFilterChange={handleFilterChange} initialFilters={filters} />

      {filteredProducts.length === 0 ? (
        <div className="text-center py-12">
          <p className="text-gray-500 text-lg">No products match your filters</p>
          <button
            onClick={() => setFilters({ type: 'all', duration: 'all' })}
            className="mt-4 text-hanbok-blue hover:underline font-medium"
          >
            Clear filters
          </button>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {filteredProducts.map((product) => (
            <ProductCard
              key={product.id}
              id={product.id}
              slug={product.slug}
              name={product.name}
              price={product.price}
              regularPrice={product.regularPrice}
              image={product.image}
              duration={product.duration}
              dataAmount={product.dataAmount}
            />
          ))}
        </div>
      )}
    </>
  );
}
```

Changes from Plan 01 version:
- Add filters state with useState
- Import and render ProductFilter component
- Add useMemo for filtered products based on filter state
- Show "No products match" when filters exclude all products
- Add "Clear filters" button to reset
  </action>
  <verify>
1. Run dev server: `cd /mnt/c/82Mobile/82mobile-next && npm run dev`
2. Open http://localhost:3000 and scroll to Products section
3. Click "eSIM" filter - verify only eSIM products show
4. Click "Physical" filter - verify only physical SIM products show
5. Click "30-day" duration - verify only 30-day products show
6. Combine filters (e.g., eSIM + 7-day) - verify intersection
7. Clear filters - verify all products return
  </verify>
  <done>Filters update product grid in real-time</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Type filter (All/eSIM/Physical) works correctly
3. Duration filter (All/3-day/7-day/10-day/30-day) works correctly
4. Filters combine correctly (AND logic)
5. "No products" message shows when filters exclude all
6. Clear filters resets to show all products
7. Active filter has visual indicator (animated pill)
</verification>

<success_criteria>
- Filtering happens instantly (no API call, client-side)
- At least 60fps during filter animations
- Mobile-friendly filter UI
- Clear feedback when no products match
</success_criteria>

<output>
After completion, create `.planning/phases/02-product-discovery/02-03-SUMMARY.md`
</output>
