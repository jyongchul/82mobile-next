---
phase: 03-cart-side-drawer
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/cart/CartDrawer.tsx
  - stores/ui.ts
autonomous: true

must_haves:
  truths:
    - "Clicking 'Proceed to Checkout' shows checkout form in drawer"
    - "Back arrow returns to cart view"
    - "Checkout view has billing form fields"
    - "View state persists during session"
  artifacts:
    - path: "components/cart/CartDrawer.tsx"
      provides: "Cart and checkout views with transition"
      contains: "checkoutView"
    - path: "stores/ui.ts"
      provides: "Drawer view state management"
      contains: "setCartView"
  key_links:
    - from: "components/cart/CartDrawer.tsx"
      to: "stores/ui.ts"
      via: "cartView state"
      pattern: "cartView"
---

<objective>
Add checkout view transition within the cart drawer.

Purpose: Enable users to proceed to checkout without leaving the single-page experience.
Output: CartDrawer with cart/checkout view toggle, basic checkout form layout.
</objective>

<execution_context>
@/home/charles_lee/.claude/get-shit-done/workflows/execute-plan.md
@/home/charles_lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary
@.planning/phases/03-cart-side-drawer/03-01-SUMMARY.md

# Files to reference
@components/checkout/BillingForm.tsx
@stores/ui.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add view state to UI store</name>
  <files>stores/ui.ts</files>
  <action>
Extend UIStore to manage drawer view state:

```typescript
import { create } from 'zustand';

type CartView = 'cart' | 'checkout';

interface UIStore {
  // Drawer open/close
  isCartOpen: boolean;
  openCart: () => void;
  closeCart: () => void;
  toggleCart: () => void;

  // Drawer view (cart items vs checkout form)
  cartView: CartView;
  setCartView: (view: CartView) => void;

  // Helper: open drawer and show specific view
  openCartToCheckout: () => void;
}

export const useUIStore = create<UIStore>((set) => ({
  isCartOpen: false,
  openCart: () => set({ isCartOpen: true, cartView: 'cart' }),
  closeCart: () => set({ isCartOpen: false }),
  toggleCart: () => set((state) => ({ isCartOpen: !state.isCartOpen })),

  cartView: 'cart',
  setCartView: (view) => set({ cartView: view }),

  openCartToCheckout: () => set({ isCartOpen: true, cartView: 'checkout' }),
}));
```

Key behaviors:
- openCart() resets to 'cart' view (not stuck on checkout)
- closeCart() doesn't reset view (user might want to continue checkout)
- openCartToCheckout() opens directly to checkout (for future use)
  </action>
  <verify>
- stores/ui.ts exports CartView type
- useUIStore has cartView, setCartView, openCartToCheckout
- TypeScript compiles: npm run type-check
  </verify>
  <done>
UI store extended with cartView state and setCartView action for drawer view switching.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CartDrawer with checkout view</name>
  <files>components/cart/CartDrawer.tsx</files>
  <action>
Modify CartDrawer to support two views: cart and checkout.

1. Import cartView and setCartView from useUIStore:
   ```typescript
   const { cartView, setCartView } = useUIStore();
   ```

2. Add AnimatePresence for view transitions in the content area:
   ```tsx
   <AnimatePresence mode="wait">
     {cartView === 'cart' ? (
       <motion.div
         key="cart-view"
         initial={{ opacity: 0, x: -20 }}
         animate={{ opacity: 1, x: 0 }}
         exit={{ opacity: 0, x: -20 }}
       >
         <CartDrawerItems />
         {/* Order summary */}
         <OrderSummary showCheckoutButton={false} />
         {/* Proceed to Checkout button */}
         <button
           onClick={() => setCartView('checkout')}
           disabled={items.length === 0}
           className="..."
         >
           Proceed to Checkout
         </button>
       </motion.div>
     ) : (
       <motion.div
         key="checkout-view"
         initial={{ opacity: 0, x: 20 }}
         animate={{ opacity: 1, x: 0 }}
         exit={{ opacity: 0, x: 20 }}
       >
         {/* Checkout content - detailed in Task 3 */}
       </motion.div>
     )}
   </AnimatePresence>
   ```

3. Update header based on view:
   - Cart view: "Your Cart (N items)" + X close button
   - Checkout view: Back arrow + "Checkout" + X close button

   ```tsx
   <div className="flex items-center justify-between p-4 border-b">
     {cartView === 'checkout' && (
       <button
         onClick={() => setCartView('cart')}
         className="p-2 hover:bg-gray-100 rounded-lg"
         aria-label="Back to cart"
       >
         <svg className="w-5 h-5" ... /> {/* Left arrow */}
       </button>
     )}
     <h2 className="font-heading text-xl font-bold">
       {cartView === 'cart' ? `Your Cart (${itemCount})` : 'Checkout'}
     </h2>
     <button onClick={onClose} aria-label="Close" className="...">
       <svg ... /> {/* X icon */}
     </button>
   </div>
   ```

4. Ensure close button is always visible in both views
  </action>
  <verify>
- CartDrawer imports cartView, setCartView from useUIStore
- Has AnimatePresence with mode="wait" for view transitions
- Header shows back arrow in checkout view
- Proceed to Checkout button changes view to checkout
- TypeScript compiles: npm run type-check
  </verify>
  <done>
CartDrawer updated with cart/checkout view switching, animated transitions, and dynamic header.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create checkout view content</name>
  <files>components/cart/CartDrawerCheckout.tsx</files>
  <action>
Create CartDrawerCheckout component for the checkout form inside drawer:

```tsx
'use client';

import { useCartStore } from '@/stores/cart';

export default function CartDrawerCheckout() {
  const items = useCartStore((state) => state.items);
  const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
  const tax = Math.round(total * 0.1);
  const grandTotal = total + tax;

  return (
    <div className="flex flex-col h-full">
      {/* Order Summary - compact */}
      <div className="p-4 bg-gray-50 rounded-lg mb-4">
        <h3 className="font-medium text-gray-900 mb-2">Order Summary</h3>
        <div className="space-y-1 text-sm text-gray-600">
          <div className="flex justify-between">
            <span>{items.length} item(s)</span>
            <span>₩{total.toLocaleString()}</span>
          </div>
          <div className="flex justify-between">
            <span>VAT (10%)</span>
            <span>₩{tax.toLocaleString()}</span>
          </div>
          <div className="flex justify-between font-bold text-gray-900 pt-2 border-t">
            <span>Total</span>
            <span className="text-dancheong-red">₩{grandTotal.toLocaleString()}</span>
          </div>
        </div>
      </div>

      {/* Billing Form - simplified for drawer */}
      <form className="flex-1 overflow-y-auto space-y-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
          <input
            type="email"
            required
            className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-dancheong-red focus:border-transparent"
            placeholder="your@email.com"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
          <input
            type="text"
            required
            className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-dancheong-red focus:border-transparent"
            placeholder="John Doe"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-1">Phone *</label>
          <input
            type="tel"
            required
            className="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-dancheong-red focus:border-transparent"
            placeholder="+1 234 567 8900"
          />
        </div>

        {/* Note: Full checkout implementation in Phase 4 */}
        <p className="text-sm text-gray-500 italic">
          Payment processing coming in Phase 4
        </p>
      </form>

      {/* Pay Button - sticky at bottom */}
      <div className="pt-4 border-t">
        <button
          type="submit"
          disabled
          className="w-full py-4 bg-gray-300 text-gray-500 font-bold rounded-lg cursor-not-allowed"
        >
          Pay ₩{grandTotal.toLocaleString()} (Coming Soon)
        </button>
      </div>
    </div>
  );
}
```

Note: This is a placeholder checkout form. Full implementation with react-hook-form, zod validation, and payment integration comes in Phase 4. This plan focuses on the drawer transition mechanics.
  </action>
  <verify>
- File exists at components/cart/CartDrawerCheckout.tsx
- Has email, name, phone input fields
- Shows order total from cart
- TypeScript compiles: npm run type-check
  </verify>
  <done>
CartDrawerCheckout component created with placeholder billing form and order summary for Phase 3 drawer transition. Full checkout logic deferred to Phase 4.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. npm run type-check passes
2. npm run build succeeds
3. Clicking "Proceed to Checkout" in cart drawer shows checkout form
4. Back arrow in checkout view returns to cart view
5. Order total displays correctly in checkout view
</verification>

<success_criteria>
- "Proceed to Checkout" button transitions drawer to checkout view
- Back arrow in checkout view returns to cart items
- View transitions are animated (slide left/right)
- Order summary shows in checkout view
- Basic form fields visible (email, name, phone)
- UI store manages view state
</success_criteria>

<output>
After completion, create `.planning/phases/03-cart-side-drawer/03-03-SUMMARY.md`
</output>
