---
phase: 03-cart-side-drawer
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/layout/Header.tsx
  - app/[locale]/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Cart icon click opens drawer (not navigates to page)"
    - "Cart badge still shows item count"
    - "Drawer opens on any page, not just homepage"
    - "Adding product opens drawer briefly as feedback"
  artifacts:
    - path: "components/layout/Header.tsx"
      provides: "Cart button with onClick handler"
      contains: "openCart"
    - path: "app/[locale]/layout.tsx"
      provides: "CartDrawer mounted at layout level"
      contains: "CartDrawer"
  key_links:
    - from: "components/layout/Header.tsx"
      to: "stores/ui.ts"
      via: "useUIStore openCart"
      pattern: "useUIStore.*openCart"
    - from: "app/[locale]/layout.tsx"
      to: "components/cart/CartDrawer.tsx"
      via: "component import"
      pattern: "import.*CartDrawer"
---

<objective>
Wire CartDrawer to Header and mount at layout level for global access.

Purpose: Enable users to open cart drawer from any page via header icon click.
Output: Header with cart button instead of link, CartDrawer mounted in root layout.
</objective>

<execution_context>
@/home/charles_lee/.claude/get-shit-done/workflows/execute-plan.md
@/home/charles_lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary (created this phase)
@.planning/phases/03-cart-side-drawer/03-01-SUMMARY.md

# Files to modify
@components/layout/Header.tsx
@app/[locale]/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Header to open drawer on cart click</name>
  <files>components/layout/Header.tsx</files>
  <action>
Modify Header component:

1. Import useUIStore from stores/ui:
   ```typescript
   import { useUIStore } from '@/stores/ui';
   ```

2. Get openCart function from UI store:
   ```typescript
   const openCart = useUIStore((state) => state.openCart);
   ```

3. Change cart Link to button:

   BEFORE (around line 137):
   ```tsx
   <Link
     href={`/${locale}/cart`}
     className="relative p-2..."
   >
   ```

   AFTER:
   ```tsx
   <button
     onClick={openCart}
     className="relative p-2 text-gray-700 hover:text-dancheong-red transition-colors group"
     aria-label="Open cart"
   >
   ```

4. Keep the SVG icon and badge exactly the same (just change wrapper from Link to button)

5. Remove the Link import if no longer needed (check if used elsewhere in file)

Important: Keep cartItemCount logic unchanged, just change the wrapper element.
  </action>
  <verify>
- File contains: import { useUIStore } from '@/stores/ui'
- File contains: onClick={openCart}
- Cart button has aria-label="Open cart"
- TypeScript compiles: npm run type-check
  </verify>
  <done>
Header cart icon changed from Link to button that calls openCart from UI store.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mount CartDrawer in root layout</name>
  <files>app/[locale]/layout.tsx</files>
  <action>
Add CartDrawer to the layout so it's available on all pages:

1. Import CartDrawer and useUIStore:
   ```typescript
   import CartDrawer from '@/components/cart/CartDrawer';
   ```

2. Create a client wrapper component in the same file (or import from separate file) to handle the store access:

   Since layout.tsx is async (server component), we need a client component wrapper.

   Option A (inline): Create CartDrawerWrapper in layout file
   ```tsx
   'use client';
   function CartDrawerWrapper() {
     const { isCartOpen, closeCart } = useUIStore();
     return <CartDrawer isOpen={isCartOpen} onClose={closeCart} />;
   }
   ```

   Option B (cleaner): Create separate file components/cart/CartDrawerWrapper.tsx

   Use Option B for cleaner separation.

3. Add CartDrawerWrapper after ToastProvider inside the LenisProvider:
   ```tsx
   <LenisProvider>
     <div className="min-h-screen flex flex-col">
       <Header />
       <main className="flex-1">{children}</main>
       <Footer />
     </div>
     <ToastProvider />
     <CartDrawerWrapper />
   </LenisProvider>
   ```

Create components/cart/CartDrawerWrapper.tsx as a 'use client' component that:
- Imports useUIStore
- Imports CartDrawer
- Passes isCartOpen and closeCart as props
  </action>
  <verify>
- File components/cart/CartDrawerWrapper.tsx exists
- app/[locale]/layout.tsx imports CartDrawerWrapper
- TypeScript compiles: npm run type-check
  </verify>
  <done>
CartDrawer mounted at layout level via CartDrawerWrapper, accessible from all pages.
  </done>
</task>

<task type="auto">
  <name>Task 3: Auto-open drawer on add-to-cart</name>
  <files>components/shop/ProductCard.tsx</files>
  <action>
Enhance add-to-cart feedback by briefly opening the drawer:

1. Import useUIStore:
   ```typescript
   import { useUIStore } from '@/stores/ui';
   ```

2. Get openCart from store:
   ```typescript
   const openCart = useUIStore((state) => state.openCart);
   ```

3. In handleAddToCart, after showing toast, open the drawer:
   ```typescript
   const handleAddToCart = async (e: React.MouseEvent) => {
     e.preventDefault();
     e.stopPropagation();

     setIsAdding(true);

     addItem({
       productId: id,
       name,
       slug,
       price: parseFloat(price.replace(/,/g, '')),
       image
     }, 1);

     setTimeout(() => {
       setIsAdding(false);
       toast.success(`${name} added to cart!`, {
         icon: 'ðŸ›’',
         duration: 3000,
       });
       // Open cart drawer to show added item
       openCart();
     }, 500);
   };
   ```

This provides immediate visual feedback showing the item in cart.
  </action>
  <verify>
- File contains: import { useUIStore } from '@/stores/ui'
- File contains: openCart()
- TypeScript compiles: npm run type-check
  </verify>
  <done>
ProductCard now opens cart drawer after adding item, providing visual feedback.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. npm run type-check passes
2. npm run build succeeds
3. Cart icon in header is a button (not link)
4. CartDrawerWrapper is in layout
5. ProductCard opens drawer on add
</verification>

<success_criteria>
- Clicking cart icon opens drawer (no page navigation)
- Drawer appears from right on desktop, bottom on mobile
- Adding product to cart opens drawer automatically
- Cart badge count still visible and accurate
- Works on all pages (homepage, shop, product detail)
</success_criteria>

<output>
After completion, create `.planning/phases/03-cart-side-drawer/03-02-SUMMARY.md`
</output>
