---
phase: 03-cart-side-drawer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/cart/CartDrawer.tsx
  - components/cart/CartDrawerItems.tsx
autonomous: true

must_haves:
  truths:
    - "Drawer slides in from right on desktop (width 400px)"
    - "Drawer slides up from bottom on mobile (height 80vh)"
    - "Backdrop dims page when drawer open"
    - "Clicking backdrop closes drawer"
    - "Cart items display with quantity controls"
    - "Empty state shows when cart is empty"
  artifacts:
    - path: "components/cart/CartDrawer.tsx"
      provides: "Main drawer shell with animations"
      min_lines: 80
    - path: "components/cart/CartDrawerItems.tsx"
      provides: "Compact cart items for drawer"
      min_lines: 50
  key_links:
    - from: "components/cart/CartDrawer.tsx"
      to: "stores/cart.ts"
      via: "useCartStore hook"
      pattern: "useCartStore"
    - from: "components/cart/CartDrawerItems.tsx"
      to: "stores/cart.ts"
      via: "updateQuantity, removeItem"
      pattern: "(updateQuantity|removeItem)"
---

<objective>
Create the CartDrawer component with responsive slide-in animations.

Purpose: Enable users to view and manage cart without leaving the current page, maintaining single-page flow.
Output: CartDrawer.tsx with Framer Motion animations, CartDrawerItems.tsx with compact item display.
</objective>

<execution_context>
@/home/charles_lee/.claude/get-shit-done/workflows/execute-plan.md
@/home/charles_lee/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md

# Key reference files
@stores/cart.ts
@components/cart/CartItems.tsx
@components/cart/OrderSummary.tsx
@components/home/ProductExpanded.tsx (AnimatePresence pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CartDrawer shell with animations</name>
  <files>components/cart/CartDrawer.tsx</files>
  <action>
Create CartDrawer component with:

1. Props interface:
   - isOpen: boolean
   - onClose: () => void

2. Animation variants using Framer Motion:
   - Desktop (md+): slide from right, width 400px
   - Mobile (<md): slide from bottom, height 80vh, rounded top corners

3. Structure:
   - Backdrop (AnimatePresence + motion.div, opacity 0->0.5, black)
   - Drawer panel (motion.div with responsive variants)
   - Header with "Your Cart" title + close button (X icon)
   - Content area with CartDrawerItems (scrollable)
   - Footer with OrderSummary (without continue shopping link)
   - "Proceed to Checkout" button at bottom

4. Close behaviors:
   - Click backdrop
   - Click X button
   - Press Escape key (useEffect with keydown listener)

5. Prevent body scroll when open:
   - useEffect to toggle document.body.style.overflow

Use existing Framer Motion patterns from ProductExpanded.tsx for AnimatePresence.

Tailwind classes for responsive:
- md:right-0 md:w-[400px] md:h-full
- right-0 bottom-0 w-full h-[80vh] rounded-t-3xl md:rounded-none
  </action>
  <verify>
- File exists at components/cart/CartDrawer.tsx
- TypeScript compiles: npm run type-check
- Imports useCartStore from stores/cart
- Has AnimatePresence wrapper
- Has backdrop and panel motion.divs
  </verify>
  <done>
CartDrawer.tsx created with responsive slide animations, backdrop, close button, and proper accessibility (Escape key handling).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CartDrawerItems compact view</name>
  <files>components/cart/CartDrawerItems.tsx</files>
  <action>
Create CartDrawerItems component - a more compact version of CartItems for the drawer:

1. Use same cart store hooks: useCartStore for items, updateQuantity, removeItem

2. Compact layout (vs full CartItems):
   - Smaller image (48x48px instead of 96x96)
   - Inline quantity controls (smaller buttons)
   - Price and subtotal on same row
   - Remove button as small trash icon

3. Empty state:
   - Center-aligned message "Your cart is empty"
   - Optional emoji/icon
   - Text encouraging browsing

4. Structure per item:
   ```
   [Image 48x48] | Name          | [Trash]
                 | Price         |
                 | [-] qty [+]   | Subtotal
   ```

5. Animations:
   - AnimatePresence for item removal
   - motion.div with layout for reordering
   - exit animation: opacity 0, x: -20

Use map() with item.productId as key.
  </action>
  <verify>
- File exists at components/cart/CartDrawerItems.tsx
- TypeScript compiles: npm run type-check
- Has empty state render
- Imports useCartStore
- Uses AnimatePresence for item animations
  </verify>
  <done>
CartDrawerItems.tsx created with compact layout, quantity controls, remove functionality, empty state, and smooth item removal animations.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create cart drawer state store</name>
  <files>stores/ui.ts</files>
  <action>
Create a UI state store for drawer visibility:

```typescript
import { create } from 'zustand';

interface UIStore {
  isCartOpen: boolean;
  openCart: () => void;
  closeCart: () => void;
  toggleCart: () => void;
}

export const useUIStore = create<UIStore>((set) => ({
  isCartOpen: false,
  openCart: () => set({ isCartOpen: true }),
  closeCart: () => set({ isCartOpen: false }),
  toggleCart: () => set((state) => ({ isCartOpen: !state.isCartOpen })),
}));
```

This separates UI state from cart data, following the existing pattern where cart.ts handles cart data.

No persist middleware needed - drawer should start closed on page load.
  </action>
  <verify>
- File exists at stores/ui.ts
- TypeScript compiles: npm run type-check
- Exports useUIStore hook
  </verify>
  <done>
UI store created with isCartOpen state and openCart/closeCart/toggleCart actions.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. npm run type-check passes
2. npm run build succeeds
3. All three files exist with correct exports
4. No circular dependencies introduced
</verification>

<success_criteria>
- CartDrawer.tsx exports default component with isOpen, onClose props
- CartDrawerItems.tsx exports default component
- stores/ui.ts exports useUIStore hook
- TypeScript compilation succeeds
- Ready for integration with Header in Plan 02
</success_criteria>

<output>
After completion, create `.planning/phases/03-cart-side-drawer/03-01-SUMMARY.md`
</output>
